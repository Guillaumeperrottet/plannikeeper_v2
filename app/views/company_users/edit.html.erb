
<div class="container py-5 d-flex justify-content-center align-items-center min-vh-100">
  <div class="card shadow-lg rounded-4 p-4" style="min-width: 400px; max-width: 500px; width: 100%;">
    <h2 class="mb-4 text-center fw-bold" style="letter-spacing: 1px;">Modifier l'Utilisateur</h2>

    <% if flash[:notice] %>
      <div class="alert alert-success rounded-pill text-center">
        <%= flash[:notice] %>
      </div>
    <% elsif flash[:alert] %>
      <div class="alert alert-danger rounded-pill text-center">
        <%= flash[:alert] %>
      </div>
    <% end %>

    <%= form_with(model: @user, url: company_user_path(@user), method: :patch, html: { class: "mt-3" }) do |f| %>
      <div class="mb-3">
        <%= f.label :email, "Email", class: "form-label fw-semibold" %>
        <%= f.text_field :email, class: "form-control form-control-lg rounded-pill", disabled: true %>
      </div>

      <div class="mb-3">
        <%= f.label :role, "Rôle", class: "form-label fw-semibold" %>
        <%= f.select :role, User.roles.slice('enterprise_user', 'enterprise_admin').keys.map { |r| [r.humanize, r] }, { selected: @user.role }, class: "form-select rounded-pill" %>
      </div>

      <div class="mb-3">
        <%= f.label :objets, "Objets accessibles", class: "form-label fw-semibold" %>
        <div class="d-flex flex-wrap gap-2">
          <% Objet.where(company_id: current_user.company_id).each do |objet| %>
            <div class="form-check form-switch">
              <%= check_box_tag 'user[objet_ids][]', objet.id, @user.objets.include?(objet), id: "user_objet_#{objet.id}", class: 'form-check-input', style: "cursor:pointer;" %>
              <%= label_tag "user_objet_#{objet.id}", objet.nom, class: 'form-check-label', style: "cursor:pointer;" %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Permissions</label>
        <div class="d-flex flex-column gap-2">
          <div class="form-check">
            <%= f.check_box :can_manage_tasks, class: "form-check-input", id: "can_manage_tasks" %>
            <%= f.label :can_manage_tasks, "Peut gérer les tâches", class: "form-check-label", for: "can_manage_tasks" %>
          </div>
          <div class="form-check">
            <%= f.check_box :can_view_reports, class: "form-check-input", id: "can_view_reports" %>
            <%= f.label :can_view_reports, "Peut voir les rapports", class: "form-check-label", for: "can_view_reports" %>
          </div>
        </div>
      </div>

      <div class="d-grid mt-4">
        <%= f.submit "Mettre à jour", class: "btn btn-primary btn-lg rounded-pill fw-bold shadow-sm" %>
      </div>
    <% end %>
  </div>
</div>
